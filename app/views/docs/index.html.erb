<section id="docs">
  <div class="fixed-side-menu">
    <div class="outer-wrapper">
      <div class="inner-wrapper">
        <div style="margin-top: 20px;">
          <%= image_tag "canary-map.medium.stroke.png", :style => "width: 150px" %>
          <h2 style="text-align: center">API Docs</h2>
        </div>
        <ul class="nav nav-pills nav-stacked">
          <li><a href="#start">Getting started</a></li>
          <li><a href="#authentication">Authentication</a></li>
          <li><a href="#check-endpoint">Check endpoint</a></li>
          <li><a href="#check-responses">Check responses</a></li>
          <li><a href="#errors">Errors</a></li>
          <li><a href="#feedback">Questions? Feedback?</a></li>
        </ul>

      </div>
    </div>
  </div>
  <div class="col-sm-7">
    <a name="start" class="anchor-offset"></a>
    <h1>Hello!</h1>
    <p>Welcome to Appcanary. The purpose of this documentation is to show you how to connect to our service. This API and accompanying documentation is in beta, pending feedback from users just like you.</p> 
    <p><strong>Please tell us what you think!</strong> Also, we will be careful and try to communicate this clearly when it happens, but given the feedback we receive we may ship breaking changes.</p>

    <hr>
    <a name="authentication" class="anchor-offset"></a>
    
    <h2>Authentication</h2>
    <p>All communication with our APIs require your API key to be included as an <code>Authentication</code> header. These can be set in <code>curl</code> like so:</p>
    <pre class="bash">curl -H "Authorization: Token <%= @user.agent_token %>" \
     https://appcanary.com/api/v2/status</pre>

    <p>The status endpoint shown above will respond appropriately if your request is authenticated and your account is in good standing.</p>
    <hr>
    <a name="check-endpoint" class="anchor-offset"></a>
    <h2>Check endpoint</h2>
    <h4><code>https://appcanary.com/api/v2/check/ruby</code></h4>
    <p>The purpose of this endpoint is to show which vulnerabilities your app's dependencies are affected by.</p> 
    <p>Application dependencies are typically expressed in a file; at the moment we only accept requests with <code>Content-Type: multipart/form-data</code> with an embedded <code>application/octet-stream</code>. Soon, we'll also be accepting JSON.</p>

    <p>Simply <code>POST</code> your file to <code>https://appcanary.com/api/v2/check/ruby</code> - like so:</p>

    <pre class="bash">curl -H "Authorization: Token <%= @user.agent_token %>" \
     -X POST -F file=@./Gemfile.lock \
     https://appcanary.com/api/v2/check/ruby
</pre>

    <h4>Required parameters</h4>
     <dl class="dl-horizontal">
      <dt>file</dt>
      <dd>The dependency file you want to check, form encoded.<br/>
        i.e. a <code>Gemfile.lock</code>; the API will not work against just a <code>Gemfile</code>.</dd>
    </dl>

    <h4>Please note!</h4>
    <p>We <strong>do not store raw submitted files</strong>, only our parsed representations. We strive to discard sensitive information but be mindful when submitting files containing credentials.</p>
    <p>All requests are currently unmetered. This may change as appropriate.</p>

    <hr>
    <a name="check-responses" class="anchor-offset"></a>
    <h2>Check Responses</h2>
    <p>Successful requests will have a <code>200 OK</code> response code containing <code>application/json</code> data.</p>
    <p>All successful responses will be wrapped in a <code>"data"</code> container object and contain a <code>"vulnerable"</code> boolean field. This container object <strong>shall always</strong> contain an array, whether it's empty or not.</p>
    <p>For example, if your dependency file does not have any known vulnerabilities, the response body will look like this:</p>
    <pre class="json">
{
  "vulnerable": false
  "data": []
}
</pre>
    
    <h4>The request container object</h4>
    <dl class="dl-horizontal">
      <dt>data</dt>
      <dd>An array containing the data we're returning. May be empty if there is no data</dd>

      <dt>metadata</dt>
      <dd>An array of metadata attributes largely meant for human consumption. The primary means of warning you of deprecation, or rate overages.</dd>
    </dl>

    <p>However, if your app does have vulnerable dependencies, then the container object will consist of a series of <code>artifact-version</code> objects, and look like the following example response:</p>
        <pre class="json">
{
  "vulnerable": true
  "data": [
    {
      "type": "artifact-version",
      "attributes": {
        "name": "rack",
        "kind": "rubygem",
        "number": "1.6.0",
        "vulnerabilities": [
          {
            "title": "Potential Denial of Service Vulnerability in Rack",
            "description": "Carefully crafted requests can cause a `SystemStackError` and potentially \ncause a denial of service attack. \n\nAll users running an affected release should upgrade.",
            "criticality": "high",
            "cve": [
              "CVE-2015-3225"
            ],
            "osvdb": [],
            "patched-versions": [
              "~&lt; 1.5.4",
              "~&lt; 1.4.6",
              "&gt;= 1.6.2"
            ],
            "unaffected-versions": [],
            "uuid": "55807540-053f-40f0-9266-a3d1ca6a5838",
            "upgrade-to": [
              "&gt;= 1.6.2"
            ]
          }
        ]
      }
    }
  ]
}
</pre>
    <h4>ArtifactVersion container object</h4>
    <dl class="dl-horizontal">
      <dt>type</dt>
      <dd>Describes the type of the resource - may only be "<code>artifact-version</code>"</dd>
      <dt>attributes</dt>
      <dd>A nested series of attributes relating to the ArtifactVersion.</dd>
    </dl>

    <h4>ArtifactVersion attributes object</h4>
    <p>An ArtifactVersion may be thought of as a unique (<code>name</code>, <code>kind</code>, <code>number</code>) tuple.</p>

    <dl class="dl-horizontal">
      <dt>name</dt>
      <dd>The name of the package, dependency or artifact</dd>
      <dt>kind</dt>
      <dd>The name of the platform, ecosystem or environment this artifact belongs to. Currently it may only be <code>rubygem</code>.</dd>
      <dt>number</dt>
      <dd>The specific version string of the artifact being discussed. Version string formats vary from artifact kind to artifact kind.</dd>

      <dt>vulnerabilities</dt>
      <dd>A array of objects describing the vulnerabilities that affect this specific ArtifactVersion. Due to the nature of this API endpoint, this array should never be empty.</dd>
    </dl>

    <h4>Vulnerabilty object</h4>
    <dl class="dl-horizontal">
      <dt>title</dt>
      <dd>A human readable summary of the vulnerability.</dd>

      <dt>description</dt>
      <dd>A human readable long form description of the vulnerability. May contain unescaped HTML or raw markdown - beware if injecting this into a web page</dd>

      <dt>criticality</dt>
      <dd>A subjective rating of how seriously of this vulnerability should be treated. May consist of <code>unknown</code>, <code>low</code>, <code>medium</code> or <code>high</code>. </dd>

      <dt>cve</dt>
      <dd>An array of strings, containing CVE ids. A given vulnerability may be related to multiple CVEs. If none are available, will present an empty array.</dd>

      <dt>osvdb</dt>
      <dd>An array of strings, containing OSVDB ids. A given vulnerability may be related to multiple OSVDB ids. If none are available, will present an empty array.</dd>

      <dt>patched-versions</dt>
      <dd>An array of versions strings representing new releases of the artifact that have been patched to deal with the vulnerability. The strings usually contain version operators like <code>~</code> or <code>&gt;=</code>.<br/><br/>We strive to only tell you about patched vulnerabilities, but it's possible that this array may turn up empty. Note: the semantics of the version operators may be different from artifact kind to artifact kind.</dd>

      <dt>unaffected-versions</dt>
      <dd>An array of version strings representing releases of the artifact that are unaffected by this vulnerability. In the absence of unaffected versions, this array may be empty.</dd>

      <dt>upgrade-to</dt>
      <dd>An array of version strings representing and sorted by the <strong>nearest upgrade</strong>. Use this field to guide you to the next closest version to your current one. If the <code>patched-versions</code> field is empty, so will this one.</dd>

      <dt>uuid</dt>
      <dd>A randomly generated identifier. Refer to this field when submitting support requests.</dd>
    </dl>

    <hr>
    <a name="errors" class="anchor-offset"></a>

    <h2>Errors</h2>
    <p>Occasionally, we won't be able to process your request. We'll try to give you meaningful hints. All responses shall have a 400 or 500 series status - most commonly one of: <code>400 Bad Request</code>, <code>422 Unprocessable Entity</code> or <code>500 Internal Server Error</code>.</p>
    <p>A sample error request looks like the following:</p>
    <pre class="json">
{
  "errors": [
    {
      "title": "Validation error",
      "details": {
        "file": "missing-required-key"
      }
    }
  ]
}</pre>

    <p>When responding with an error, the API shall always omit the <code>data</code> container object and return instead an <code>errors</code> object, which shall always contain an array.</p>

    <h4>The error object</h4>
    <dl class="dl-horizontal">
      <dt>title</dt>
      <dd>A human readable description of the problem.</dd>

      <dt>details</dt>
      <dd>A series of keys and values meant to provide clues or context as to what went wrong.</dd>

    </dl>

    <hr>
    <a name="feedback" class="anchor-offset"></a>
    <h2>Questions? Feedback?</h2>

    <p>Let us know. Hit "Feedback" on the bar up top or contact us at <a href="mailto:hello@appcanary.com">hello@appcanary.com</a>. Include as much detail or context as possible. Thanks!</p>
   
  </div>
</section>
