<div id="vuln_dashboard">
  <h1 class="page-header">Recent patches</h1>

  <div class="col-sm-12">
    <table id="vulnerability_list" class="table packages">
      <thead>
        <th class="col-sm-4">vuln</th>
        <th>priority</th>
        <th>still present?</th>
        <th class="col-sm-4">affected bundles or tags</th>
        <th class="col-sm-2">patched ago (faked)</th>
      </thead>
      <% @lbps.each do |lbp| %>
        <% vuln = lbp.vulnerability %>

        <tr>
          <td>
            <%= platform_icon(vuln.platform, false) %> <%= link_to vuln.title, vuln_path(vuln) %>
          </td>

          <td data-order="<%= vuln.criticality_ordinal %>">
            <%= vuln.criticality %>
          </td>

          <td>
            <% if rand(10) == 1 %>
              <span class="fa fa-exclamation-triangle warn"></span>
            <% else %>
            <% end %>
          </td>

          <td class="package-name">
            <%# <% tagged, untagged =  @THREATS[vuln].partition { |b| b.tags.present? } %>

            <%# <%=  tagged.map(&:tags).flatten.group_by { |t| t }.map { |t, a| [t, a.size]}.sort_by(&:first).map { |t, s| link_to("#{t} (#{s})", "", class: "btn btn-sm btn-default")}.join(" ").html_safe %>

            <%= link_to("untagged (#{rand(14)})", "",  class: "btn btn-sm btn-default") %>

          </td>

          <td data-order="<%=  lbp.occurred_at %>">
            <%= time_ago_in_words lbp.occurred_at %> ago
          </td>

        </tr>
      <% end  %>
    </table>
  </div>


</div>

<script>
  $( document ).ready(function() {
    $('#vulnerability_list').DataTable({
      order: [[ 3, 'desc' ]],
     "dom": "<'row'<'col-sm-6'f><'col-sm-6'l>>" + "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-5'i><'col-sm-7'p>>",
      drawCallback: function () { $('[data-toggle="tooltip"]').tooltip() },
    });
  });
</script>

