# == Schema Information
#
# Table name: vulnerability_archives
#
#  id               :integer          not null, primary key
#  vulnerability_id :integer          not null
#  platform         :string           not null
#  title            :string
#  description      :text
#  criticality      :string
#  reference_ids    :string           default("{}"), not null, is an Array
#  osvdb_id         :string
#  usn_id           :string
#  dsa_id           :string
#  rhsa_id          :string
#  cesa_id          :string
#  source           :string
#  reported_at      :datetime
#  created_at       :datetime         not null
#  updated_at       :datetime         not null
#  valid_at         :datetime         not null
#  expired_at       :datetime         not null
#
# Indexes
#
#  idx_vulnerability_id_ar                     (vulnerability_id)
#  index_vulnerability_archives_on_expired_at  (expired_at)
#  index_vulnerability_archives_on_platform    (platform)
#  index_vulnerability_archives_on_valid_at    (valid_at)
#

class VulnerabilityArchive < ActiveRecord::Base
  extend ArchiveBehaviour::ArchiveModel

  belongs_to :current, :class_name => Vulnerability, :foreign_key => :vulnerability_id

  enum criticality: Advisory::CRITICALITIES


  def advisories
    Advisory.as_of(self.valid_at).where(:id => AdvisoryVulnerability.as_of(self.valid_at).where(:vulnerability_id => self.vulnerability_id).select(:advisory_id))
  end

  def vulnerable_dependencies
    VulnerableDependency.as_of(self.valid_at).where(:vulnerability_id => self.vulnerability_id)
  end

  def archives
    []
  end
end
