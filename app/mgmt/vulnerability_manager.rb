class VulnerabilityManager
  def create(proto_vuln)
    vuln = Vulnerability.new(proto_vuln)
    unless vuln.save
      raise "vuln problem, deal w/later somehow"
    end

    return update_affected_packages!(vuln)
  end

  def update_affected_packages!(vuln)
    concerned_packages = vuln.concerned_packages
    affected_packages = concerned_packages.select do |package|
      vuln.affects?(package)
    end

    # TODO: vulnlog? handle diff?
    vuln.packages = affected_packages

    vuln
  end

  def update_affecting_vulnerabilities!(possible_vulns, package)
    possible_vulns.select do |vuln|
      if vuln.affects?(package)
        # TODO: vulnlog? handle diff?
        vuln.packages << package
      end
    end
  end
end
