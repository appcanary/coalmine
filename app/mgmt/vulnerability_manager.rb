class VulnerabilityManager < ServiceManager
  def create(proto_vuln)
    vuln = Vulnerability.new(proto_vuln)

    begin
      vuln.transaction do
        vuln.save!

        vuln = VulnerabilityMaker.new.update_affected_packages!(vuln)
      end
    rescue ActiveRecord::RecordInvalid => e
      return Result.new(vuln, e)
    end

    return Result.new(vuln)
  end

  def update(vuln_id, attr)
    vuln = Vulnerability.find(vuln_id)

    begin
      vuln.transaction do
        vuln.update_attributes!(attr)
        VulnerabilityMaker.new.update_affected_packages!(vuln)
      end
    rescue ActiveRecord::RecordInvalid => e
      return Result.new(vuln, e)
    end

    return Result.new(vuln)
  end

end
