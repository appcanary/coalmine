class Vulnerability < CanaryBase
  
  attr_params :description, :osvdb, :reported_at, :cve, :title, :id, :artifact, :uuid, :versions, :unaffected_versions, :patched_versions, :criticality
  attr_enforce_collection :patched_versions, :unaffected_versions

  has_one Artifact

  delegate :name, :kind, :to => :artifact, :prefix => true

  def self.find(id)
    self.client.vulnerability(id)
  end

  def to_param
    uuid
  end

  def cve_id
    cve.try(:first).try(:[], "cve-id")
  end

  def cve_url
    cve.try(:first).try(:[], "url")
  end

  def osvdb_id
    osvdb.try(:first).try(:[], "osvdb-id")
  end

  def osvdb_url
    osvdb.try(:first).try(:[], "osvdb-url")
  end


  def criticality_name
    criticality.split("/").last
  end

  def kind
    artifact.kind.split("/").last
  end
end
