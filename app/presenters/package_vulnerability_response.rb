# TODO: move into serializers, this is actually
# a serializer for PackageReports
class PackageVulnerabilityResponse
  attr_accessor :query
  def initialize(q)
    self.query = q
  end

  def serialize
    ActiveModelSerializers::SerializableResource.new(query, adapter: :json_api, include: "vulnerabilities", meta: meta_key)
  end

  def meta_key
    if query.present?
      {vulnerable: true}
    else
      {vulnerable: false}
    end
  end

  # TODO: document why this is necessary.
  # iirc, it has to do with how we initialize it 
  # in controllers: we do it in a non standard way
  # in order to capture the meta_key above.

  def to_json(wat)
    serialize.to_json(wat)
  end
end

